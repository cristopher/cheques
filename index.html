<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Cheques - Banco de Chile</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 40px;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #2a5298;
        }

        .form-section h3 {
            color: #2a5298;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .cheque-list {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .cheque-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cheque-item:last-child {
            border-bottom: none;
        }

        .cheque-item:nth-child(even) {
            background: #f9f9f9;
        }

        .person-info {
            flex: 1;
        }

        .person-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .person-amount {
            color: #666;
            font-size: 0.9rem;
        }

        .cheque-number {
            background: #2a5298;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .btn {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(42, 82, 152, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        }

        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .preview-section {
            background: #fff;
            border: 2px dashed #e1e5e9;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin-top: 30px;
        }

        .preview-section h3 {
            color: #666;
            margin-bottom: 15px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-info {
            background: #e3f2fd;
            color: #0277bd;
            border-color: #0277bd;
        }

        .alert-warning {
            background: #fff3e0;
            color: #f57c00;
            border-color: #f57c00;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¶ Generador de Cheques</h1>
            <p>Banco de Chile - Sistema de Impresi√≥n</p>
        </div>

        <div class="content">
            <div class="form-section">
                <h3>üìã Configuraci√≥n General</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="startCheck">N√∫mero de cheque inicial:</label>
                        <select id="startCheck">
                            <option value="1">(Primer cheque)</option>
                            <option value="2">(Segundo cheque)</option>
                            <option value="3">(Tercer cheque)</option>
                            <option value="4">(Cuarto cheque)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="checkDate">Fecha del cheque:</label>
                        <input type="date" id="checkDate">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üë§ Agregar Persona y Monto</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="personName">Nombre completo:</label>
                        <input type="text" id="personName" placeholder="Ej: Juan P√©rez Gonz√°lez">
                    </div>
                    <div class="form-group">
                        <label for="amount">Monto (n√∫meros):</label>
                        <input type="number" id="amount" placeholder="Ej: 150000" min="1">
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="addPerson()">+ Agregar Persona</button>
            </div>

            <div class="form-section">
                <h3>üìù Lista de Cheques a Imprimir</h3>
                <div id="chequeList" class="cheque-list">
                    <div style="padding: 40px; text-align: center; color: #999;">
                        No hay cheques agregados a√∫n
                    </div>
                </div>
            </div>

            <div class="actions">
                <button class="btn" onclick="generatePDF()">üìÑ Generar PDF</button>
                <button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è Limpiar Todo</button>
            </div>

            <div class="preview-section">
                <h3>‚ÑπÔ∏è Instrucciones</h3>
                <div class="alert alert-info">
                    <strong>C√≥mo usar:</strong> Selecciona el cheque inicial, agrega personas con sus montos, y genera el PDF. Si tienes m√°s personas que cheques disponibles, se crear√°n m√∫ltiples p√°ginas autom√°ticamente.
                </div>
                <div class="alert alert-warning">
                    <strong>Mejoras implementadas:</strong> 
                    ‚Ä¢ Margen derecho a√±adido para mejor impresi√≥n<br>
                    ‚Ä¢ El monto en palabras se divide autom√°ticamente en 2 l√≠neas si supera 60 caracteres<br>
                    ‚Ä¢ M√∫ltiples p√°ginas: Si empiezas desde el cheque 3 y agregas 6 personas, la primera p√°gina tendr√° los cheques 3 y 4, y la segunda p√°gina tendr√° los cheques 1, 2, 3 y 4 con las personas restantes.
                </div>
            </div>
        </div>
    </div>

    <script>
        let chequeData = [];
        const checkNumbers = ['2020EC 0037105', '2020EC 0037106', '2020EC 0037107', '2020EC 0037108'];

        // Establecer fecha actual por defecto
        document.getElementById('checkDate').valueAsDate = new Date();

        function addPerson() {
            const name = document.getElementById('personName').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const fecha = document.getElementById('checkDate').value;

            if (!name || !amount || amount <= 0) {
                alert('Por favor, ingresa un nombre v√°lido y un monto mayor a 0');
                return;
            }

            chequeData.push({
                name: name,
                amount: amount,
                date: fecha,
                amountWords: numberToWords(amount)
            });

            updateChequeList();
            clearForm();
        }

        function clearForm() {
            document.getElementById('personName').value = '';
            document.getElementById('amount').value = '';
        }

        function updateChequeList() {
            const listElement = document.getElementById('chequeList');
            const startCheck = parseInt(document.getElementById('startCheck').value);

            if (chequeData.length === 0) {
                listElement.innerHTML = '<div style="padding: 40px; text-align: center; color: #999;">No hay cheques agregados a√∫n</div>';
                return;
            }

            let html = '';
            let currentPage = 1;
            let personIndex = 0;

            // Calcular distribuci√≥n por p√°ginas
            while (personIndex < chequeData.length) {
                let chequesInPage, startPosition;
                
                if (currentPage === 1) {
                    // Primera p√°gina: desde el cheque seleccionado hasta el 4
                    startPosition = startCheck - 1;
                    chequesInPage = 4 - startPosition;
                } else {
                    // P√°ginas siguientes: todos los cheques (4 por p√°gina)
                    startPosition = 0;
                    chequesInPage = 4;
                }

                // Agregar encabezado de p√°gina si hay m√°s de una p√°gina
                if (chequeData.length > chequesInPage || currentPage > 1) {
                    html += `
                        <div style="background: #2a5298; color: white; padding: 10px; font-weight: bold; text-align: center;">
                            üìÑ P√ÅGINA ${currentPage}
                        </div>
                    `;
                }

                // Agregar cheques de esta p√°gina
                for (let i = 0; i < chequesInPage && personIndex < chequeData.length; i++) {
                    const item = chequeData[personIndex];
                    const checkIndex = startPosition + i;
                    
                    html += `
                        <div class="cheque-item">
                            <div class="person-info">
                                <div class="person-name">${item.name}</div>
                                <div class="person-amount">$${item.amount.toLocaleString('es-CL')} - ${item.amountWords}</div>
                            </div>
                            <div class="cheque-number">${checkNumbers[checkIndex]}</div>
                        </div>
                    `;
                    personIndex++;
                }

                currentPage++;
            }

            listElement.innerHTML = html;
        }

        function clearAll() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los datos?')) {
                chequeData = [];
                updateChequeList();
                clearForm();
            }
        }

        function numberToWords(num) {
            const units = ['', 'uno', 'dos', 'tres', 'cuatro', 'cinco', 'seis', 'siete', 'ocho', 'nueve'];
            const teens = ['diez', 'once', 'doce', 'trece', 'catorce', 'quince', 'diecis√©is', 'diecisiete', 'dieciocho', 'diecinueve'];
            const tens = ['', '', 'veinte', 'treinta', 'cuarenta', 'cincuenta', 'sesenta', 'setenta', 'ochenta', 'noventa'];
            const hundreds = ['', 'ciento', 'doscientos', 'trescientos', 'cuatrocientos', 'quinientos', 'seiscientos', 'setecientos', 'ochocientos', 'novecientos'];

            if (num === 0) return 'cero';
            if (num === 100) return 'cien';

            let result = '';

            // Millones
            if (num >= 1000000) {
                const millions = Math.floor(num / 1000000);
                if (millions === 1) {
                    result += 'un mill√≥n ';
                } else {
                    result += convertHundreds(millions) + ' millones ';
                }
                num %= 1000000;
            }

            // Miles
            if (num >= 1000) {
                const thousands = Math.floor(num / 1000);
                if (thousands === 1) {
                    result += 'mil ';
                } else {
                    result += convertHundreds(thousands) + ' mil ';
                }
                num %= 1000;
            }

            // Centenas, decenas y unidades
            if (num > 0) {
                result += convertHundreds(num);
            }

            function convertHundreds(n) {
                let str = '';
                
                if (n >= 100) {
                    if (n === 100) return 'cien';
                    str += hundreds[Math.floor(n / 100)] + ' ';
                    n %= 100;
                }

                if (n >= 20) {
                    str += tens[Math.floor(n / 10)];
                    if (n % 10 !== 0) {
                        str += ' y ' + units[n % 10];
                    }
                } else if (n >= 10) {
                    str += teens[n - 10];
                } else if (n > 0) {
                    str += units[n];
                }

                return str.trim();
            }

            return result.trim();
        }

        function generatePDF() {
            if (chequeData.length === 0) {
                alert('Agrega al menos una persona antes de generar el PDF');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'letter');

            const startCheck = parseInt(document.getElementById('startCheck').value);

            // Posiciones para cada cheque (ajustadas con margen derecho)
            const chequePositions = [
                { y: 20 },   // Primer cheque
                { y: 90 },  // Segundo cheque  
                { y: 160 },  // Tercer cheque
                { y: 229 }   // Cuarto cheque
            ];

            // M√°rgenes y l√≠mites de texto
            const rightMargin = 15; // Margen derecho en mm
            const maxWidth = 210 - 55 - rightMargin; // Ancho m√°ximo considerando m√°rgenes (210mm - margen izq - margen der)
            const lineHeight = 4; // Altura entre l√≠neas

            let currentPage = 0;
            let personIndex = 0;

            while (personIndex < chequeData.length) {
                if (currentPage > 0) {
                    doc.addPage();
                }

                // Determinar cu√°ntos cheques usar en esta p√°gina
                let startPosition, endPosition;
                
                if (currentPage === 0) {
                    // Primera p√°gina: empezar desde el cheque seleccionado
                    startPosition = startCheck - 1;
                    endPosition = 4;
                } else {
                    // P√°ginas siguientes: usar todos los cheques (1-4)
                    startPosition = 0;
                    endPosition = 4;
                }

                // Llenar los cheques disponibles en esta p√°gina
                for (let checkPos = startPosition; checkPos < endPosition && personIndex < chequeData.length; checkPos++) {
                    const item = chequeData[personIndex];
                    const pos = chequePositions[checkPos];

                    const checkDate = item.date;
            
                    // Convertir fecha a formato dd/mm/yyyy
                    let _date = new Date();

                    _date.setTime(Date.parse(checkDate))
                    let n = 1000 *60* _date.getTimezoneOffset();
                    _date.setTime(_date.getTime() + n)

                    const date = _date
                    
                    const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
                    const formattedDay = `${date.getDate().toString().padStart(2, '0')}`;
                    const formattedMonth = `${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    const formattedYear = `${date.getFullYear()}`;
                    
                    // Fecha (posici√≥n superior derecha, con margen)
                    //doc.setFontSize(11);
                    //doc.text(formattedDate, 210 - rightMargin - 5, pos.y - 0, { align: 'right' });

                    doc.setFontSize(11);
                    doc.text(formattedDay, 210 - rightMargin - 22, pos.y, { align: 'right' });

                    doc.setFontSize(11);
                    doc.text(formattedMonth, 210 - rightMargin - 10, pos.y, { align: 'right' });

                    doc.setFontSize(11);
                    doc.text(formattedYear, 210 - rightMargin+6, pos.y, { align: 'right' });
                    
                    // Nombre de la persona (l√≠nea "P√ÅGUESE A")
                    doc.setFontSize(12);
                    doc.text(item.name.toUpperCase(), 79, pos.y + 8);
                    
                    // Monto en n√∫meros (lado derecho, con margen)
                    doc.setFontSize(14);
                    doc.text(`$${item.amount.toLocaleString('es-CL')}.-`, 210 - rightMargin - 5, pos.y - 10, { align: 'right' });
                    
                    // *** SEPARACI√ìN DE MONTO EN PALABRAS EN 2 L√çNEAS SI SUPERA 60 CARACTERES ***
                    doc.setFontSize(11);
                    const wordsText = item.amountWords.toUpperCase();
                    
                    // Dividir en 2 l√≠neas si supera 56 caracteres
                    if (wordsText.length > 56) {
                        // Buscar el mejor punto de corte (preferiblemente en un espacio)
                        let cutPoint = 56;
                        
                        // Buscar hacia atr√°s el √∫ltimo espacio antes del car√°cter 60
                        for (let i = 56; i >= 30; i--) {
                            if (wordsText[i] === ' ') {
                                cutPoint = i;
                                break;
                            }
                        }
                        
                        const line1 = wordsText.substring(0, cutPoint).trim();
                        const line2 = wordsText.substring(cutPoint).trim();
                        
                        // Imprimir primera l√≠nea
                        doc.text(line1, 79, pos.y + 15);
                        // Imprimir segunda l√≠nea
                        doc.text(line2, 65, pos.y + 21);
                    } else {
                        // Texto corto, una sola l√≠nea
                        doc.text(wordsText, 79, pos.y + 15);
                    }
                    // *** FIN DE LA SEPARACI√ìN DE CARACTERES ***
                    
                    personIndex++;
                }

                currentPage++;
            }

            // Generar el PDF
            doc.save('cheques-banco-chile.pdf');
        }

        // Actualizar lista cuando cambie el cheque inicial
        document.getElementById('startCheck').addEventListener('change', updateChequeList);

        // Enter para agregar persona
        document.getElementById('amount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPerson();
            }
        });
    </script>
</body>
</html>
